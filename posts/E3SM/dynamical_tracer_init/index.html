<!DOCTYPE html>
<html lang="en">
  <head>
    
    
    
    <meta charset="utf-8" />
    <link rel="icon" href="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5-1.ico?v=1630525741731" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Your new 11ty blog" />
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/style.css" />
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/fonts/cmu.css" />
    <link rel="stylesheet" href="https://unpkg.com/katex@latest/dist/katex.min.css" />
    
    <title>Open Lab Notebook</title>

<meta name="description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="robots" content="index,follow">
<meta name="author" content="undefined">

<link rel="canonical" href="https://undefined.glitch.me/posts/E3SM/dynamical_tracer_init/">

<meta property="og:title" content="Open Lab Notebook">
<meta property="og:type" content="article">

<meta property="og:url" content="https://undefined.glitch.me/posts/E3SM/dynamical_tracer_init/">
<meta property="og:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta property="og:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://undefined.glitch.me/posts/E3SM/dynamical_tracer_init/">
<meta name="twitter:title" content="Open Lab Notebook">
<meta name="twitter:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="twitter:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">


  </head>
  <body>
  <main>
    
    
  
    


<div class="wrapper post">
  <div>
    
    <h1 class='postTitle'>Adding PV and PT as dynamical tracers to E3SM</h1>

    
    
    
    <p>Ok so PV and PT are non-zero at the end of <code>inidat,</code> which is contained in the EAM code.</p>
<p>However, at the time that <code>prim_init2</code> is called within the HOMME code, it has been zeroed out (based on log files that show min/max values).</p>
<h2>Where is <code>prim_init2</code> called?</h2>
<p>In <code>eam/src/dynamics/se/dyn_comp.F90</code>, it's called in the subroutine <code>dyn_init2</code>. Note that in idealized and adiabatic model configurations, <code>elem%Q</code> is set to zero.</p>
<h2>where is <code>dyn_init2</code> called?</h2>
<p>In <code>am/src/control/startup_initialconds.F90,</code> the routine <code>initial_conds</code> calls <code>read_inidat</code>.</p>
<h2>summary of how to handle different cases:</h2>
<p>in <code>eam/src/dynamics/se/restart_dynamics.F90</code>, <code>dyn_init2</code> is called. However, this seems to assume that all <code>Q</code> fields are read in from a restart file (reasonable).
We don't actually have to change this! It's reasonable to assume that if you are running a restart file, it was initialized using the dynamics tracers.</p>
<p>It's also called in <code>eam/src/dynamics/se/inital.F90</code></p>
<h1>Breadcrumb: where is PV_TRCR output?</h1>
<p>Idea: don't have to change it at <em>output</em> time. We can add/subtract value in EAM glue code before advection is called!
Provisionally: modify <code>stepon_run3</code> in <code>eam/src/dynamics/se/stepon.F90</code>. Wrap the call to <code>dyn_run</code>.
Current hypothesis: no matter what advection scheme you use, it's handled in calls to <code>prim_run_subcycle</code></p>
<p><code>eam/src/physics/cam/constituents.F90</code>
<code>eam/src/physics/cam/cam_diagnostics.F90</code>
these are places where generic outfld calls are defined.
The key finding is that output needs to propagate to the <code>state</code> FV physics object, which is what is passed to the outfld call.
Current hypothesis is that we should do the compensation just before passing back to physics</p>

    <div class="controls">

    
      
          <h3>
            Parent post:
      </h3>
          <ul><li><a href="/open-lab-notebook/posts/E3SM/">E3SM</a></li></ul>
      
      
      
      
      
    </div>
  </div>
</div>

      <footer class="footer">
        <div class="links">
          <a href="/">Home</a>
          <span class="divider">|</span>
          <a href="/posts">Posts</a>
          <span class="divider">|</span>
          <a href="/about">About</a>
        </div>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/remix/glitch-hello-eleventy">
        <img src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140" alt="" /> 
        Remix on Glitch
        </a>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/open-lab-notebook">
        Edit
        </a>
      </footer>
    
  </main>
   
  </body>
</html>
