<!DOCTYPE html>
<html lang="en">
  <head>
    
    
    
    <meta charset="utf-8" />
    <link rel="icon" href="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5-1.ico?v=1630525741731" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Your new 11ty blog" />
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/style.css"/>
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/fonts/cmu.css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-twilight.min.css" rel="stylesheet" />
 
    <link rel="stylesheet" href="https://unpkg.com/katex@latest/dist/katex.min.css" />
    
    <title>Open Lab Notebook</title>

<meta name="description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="robots" content="index,follow">
<meta name="author" content="undefined">

<link rel="canonical" href="https://undefined.glitch.me/posts/E3SM/e3sm_container/">

<meta property="og:title" content="Open Lab Notebook">
<meta property="og:type" content="article">

<meta property="og:url" content="https://undefined.glitch.me/posts/E3SM/e3sm_container/">
<meta property="og:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta property="og:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://undefined.glitch.me/posts/E3SM/e3sm_container/">
<meta name="twitter:title" content="Open Lab Notebook">
<meta name="twitter:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="twitter:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">


  </head>
  <body>
  <main>
    
    
  
    


<div class="wrapper post">
  <div>
    
    <h1 class='postTitle'>e3sm.def</h1>

    
    
    
    <pre><code>Bootstrap: library
From: ubuntu:18.04

%post
    apt-get update
    apt-get -y install software-properties-common
    add-apt-repository universe
    apt-get -y install apt-transport-https ca-certificates gnupg \
                         software-properties-common wget
    wget -qO - https://apt.kitware.com/keys/kitware-archive-latest.asc | apt-key add -
    apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'
    apt-get update
    apt-get -y install cmake
    apt-get -y install gcc-8 g++-8 gfortran-8
    update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-8 10
    update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-8 10
     update-alternatives --install /usr/bin/gfortran gfortran /usr/bin/gfortran-8 10
    apt-get update &amp;&amp; apt-get -y install locales csh python m4 libcurl4-openssl-dev libz-dev liblapack-dev make git subversion libxml2-utils libxml-libxml-perl libswitch-perl python3-distutils
    locale-gen en_US.UTF-8
    hostname singularity

    mkdir -p /usr/local/packages
    mkdir -p /usr/local/sources
    cd /usr/local/sources
    wget --inet4-only http://www.mpich.org/static/downloads/3.3.2/mpich-3.3.2.tar.gz
    wget --inet4-only https://support.hdfgroup.org/ftp/lib-external/szip/2.1.1/src/szip-2.1.1.tar.gz
    wget --inet4-only https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_10_6/source/hdf5-1.10.6.tar.gz
    wget --inet4-only https://github.com/Unidata/netcdf-c/archive/v4.7.3.tar.gz
    wget --inet4-only https://github.com/Unidata/netcdf-cxx4/archive/v4.3.1.tar.gz
    wget --inet4-only https://github.com/Unidata/netcdf-fortran/archive/v4.4.4.tar.gz
    wget --inet4-only https://parallel-netcdf.github.io/Release/pnetcdf-1.12.1.tar.gz

    # build mpich
    tar xzf mpich-3.3.2.tar.gz
    cd mpich-3.3.2
    export CC=gcc
    export CXX=g++
    export FC=gfortran
    ./configure --prefix=/usr/local/packages/mpich
    make -j4 &amp;&amp; make -j4 install
    cd ..

    # build parallel szip
    tar xzf szip-2.1.1.tar.gz
    cd szip-2.1.1
    export CC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export FC=/usr/local/packages/mpich/bin/mpif90
    ./configure --prefix=/usr/local/packages/szip
    make -j4 &amp;&amp; make -j4 install
    cd ..

    # build serial hdf5
    tar xzf hdf5-1.10.6.tar.gz
    cd hdf5-1.10.6
    export CC=gcc
    export CXX=g++
    export F77=gfortran
    export FC=gfortran
    ./configure --prefix=/usr/local/packages/hdf5-serial --with-szlib=/usr/local/packages/szip --disable-parallel
    make -j4 &amp;&amp; make -j4 install
    cd ..

    # build parallel hdf5
    rm -rf hdf5-1.10.6
    tar xzf hdf5-1.10.6.tar.gz
    cd hdf5-1.10.6
    export CC=/usr/local/packages/mpich/bin/mpicc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export FC=/usr/local/packages/mpich/bin/mpif90
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    ./configure --prefix=/usr/local/packages/hdf5-parallel --with-szlib=/usr/local/packages/szip --enable-parallel
    make -j4 &amp;&amp; make -j4 install
    cd ..

    # build serial netcdf
    tar xzf v4.7.3.tar.gz
    cd netcdf-c-4.7.3
    export CC=gcc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=g++
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export F77=gfortran
    export MPIF77=/usr/local/packages/mpich/bin/mpif77
    export FC=gfortran
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export LDFLAGS='-L/usr/local/packages/hdf5-serial/lib -L/usr/local/packages/szip/lib'
    ./configure --prefix=/usr/local/packages/netcdf-serial --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-serial --with-szlib=/usr/local/packages/szip
    make -j4 &amp;&amp; make -j4 install
    cd ..

    tar xzf v4.3.1.tar.gz
    cd netcdf-cxx4-4.3.1
    export CC=gcc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=g++
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export F77=gfortran
    export MPIF77=/usr/local/packages/mpich/bin/mpif77
    export FC=gfortran
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-1.10.6-serial/include -I/usr/local/packages/szip/include'
    export LDFLAGS='-L/usr/local/packages/netcdf-serial/lib -L/usr/local/packages/hdf5-serial/lib -L/usr/local/packages/szip/lib'
    export LIBS='-lnetcdf -lhdf5_hl -lhdf5 -ldl -lsz -lm -lz'
    ./configure --prefix=/usr/local/packages/netcdf-serial --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-serial --with-szlib=/usr/local/packages/szip
    make -j4 &amp;&amp; make -j4  install
    cd ..

    tar xzf v4.4.4.tar.gz
    cd netcdf-fortran-4.4.4
    export CC=gcc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=g++
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export F77=gfortran
    export MPIF77=/usr/local/packages/mpich/bin/mpif77
    export FC=gfortran
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export FFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export FCFLAGS='-static -I/usr/local/packages/netcdf-serial/include -I/usr/local/packages/hdf5-serial/include -I/usr/local/packages/szip/include'
    export LDFLAGS='-L/usr/local/packages/netcdf-serial/lib -L/usr/local/packages/hdf5-serial/lib -L/usr/local/packages/szip/lib'
    export LIBS='-lnetcdf -lhdf5_hl -lhdf5 -ldl -lsz -lm -lz'
    ./configure --prefix=/usr/local/packages/netcdf-serial  --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-serial --with-szlib=/usr/local/packages/szip--enable-valgrind-tests --enable-serial-tests --enable-extra-tests --enable-extra-example-tests
    make -j4 &amp;&amp; make -j4 install
    cd ..

    # build parallel netcdf
    rm -rf netcdf-c-4.7.3
    tar xzf v4.7.3.tar.gz
    cd netcdf-c-4.7.3
    export CC=/usr/local/packages/mpich/bin/mpicc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    unset F77
    unset MPIF77
    export FC=/usr/local/packages/mpich/bin/mpif90
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    unset FFLAGS
    unset FCFLAGS
    export LDFLAGS='-L/usr/local/packages/hdf5-parallel/lib -L/usr/local/packages/szip/lib'
    unset LIBS
    ./configure --prefix=/usr/local/packages/netcdf-parallel --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-parallel --with-szlib=/usr/local/packages/szip
    make -j4 &amp;&amp; make -j4 install
    cd ..

    rm -rf netcdf-cxx4-4.3.1
    tar xzf v4.3.1.tar.gz
    cd netcdf-cxx4-4.3.1
    export CC=/usr/local/packages/mpich/bin/mpicc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export FC=/usr/local/packages/mpich/bin/mpif90
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export LDFLAGS='-L/usr/local/packages/netcdf-parallel/lib -L/usr/local/packages/hdf5-parallel/lib -L/usr/local/packages/szip/lib'
    export LIBS='-lnetcdf -lhdf5_hl -lhdf5 -ldl -lsz -lm -lz'
    ./configure --prefix=/usr/local/packages/netcdf-parallel --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-parallel --with-szlib=/usr/local/packages/szip
    make -j4 &amp;&amp; make -j4 install
    cd ..

    rm -rf netcdf-fortran-4.4.4
    tar xzf v4.4.4.tar.gz 
    cd netcdf-fortran-4.4.4
    export CC=/usr/local/packages/mpich/bin/mpicc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    export F77=/usr/local/packages/mpich/bin/mpif77
    export MPIF77=/usr/local/packages/mpich/bin/mpif77
    export FC=/usr/local/packages/mpich/bin/mpif90
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    export CFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export CXXFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export FFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export FCFLAGS='-static -I/usr/local/packages/netcdf-parallel/include -I/usr/local/packages/hdf5-parallel/include -I/usr/local/packages/szip/include'
    export LDFLAGS='-L/usr/local/packages/netcdf-parallel/lib -L/usr/local/packages/hdf5-parallel/lib -L/usr/local/packages/szip/lib'
    export LIBS='-lnetcdf -lhdf5_hl -lhdf5 -ldl -lsz -lm -lz'
    ./configure --prefix=/usr/local/packages/netcdf-parallel  --disable-dap --enable-netcdf-4 --disable-shared --enable-static --with-hdf5=/usr/local/packages/hdf5-parallel --with-szlib=/usr/local/packages/szip--enable-valgrind-tests --enable-parallel-tests --enable-extra-tests --enable-extra-example-tests
    make -j4 &amp;&amp; make -j4 install
    cd ..


    # build pnetcdf
    tar xzf pnetcdf-1.12.1.tar.gz
    cd pnetcdf-1.12.1
    export CC=/usr/local/packages/mpich/bin/mpicc
    export MPICC=/usr/local/packages/mpich/bin/mpicc
    export CXX=/usr/local/packages/mpich/bin/mpicxx
    export MPICXX=/usr/local/packages/mpich/bin/mpicxx
    unset F77
    unset MPIF77
    export FC=/usr/local/packages/mpich/bin/mpif90
    export MPIF90=/usr/local/packages/mpich/bin/mpif90
    export MPIFC=/usr/local/packages/mpich/bin/mpif90
    unset CFLAGS
    unset CXXFLAGS
    unset FFLAGS
    unset FCFLAGS
    unset LDFLAGS
    unset LIBS
    ./configure --prefix=/usr/local/packages/pnetcdf --disable-in-place-swap
    make -j4 &amp;&amp; make -j4 install
</code></pre>

    <div class="controls">

    
      
          <h3>
            Parent post:
      </h3>
          <ul><li><a href="/open-lab-notebook/posts/E3SM/">E3SM</a></li>
<li><a href="/open-lab-notebook/posts/E3SM/singularity_E3SM/">Singularity Container</a></li></ul>
      
      
      
      
      
    </div>
  </div>
</div>


      <footer class="footer">
        <div class="links">
          <a href="/">Home</a>
          <span class="divider">|</span>
          <a href="/posts">Posts</a>
          <span class="divider">|</span>
          <a href="/about">About</a>
        </div>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/remix/glitch-hello-eleventy">
        <img src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140" alt="" /> 
        Remix on Glitch
        </a>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/open-lab-notebook">
        Edit
        </a>
      </footer>
    
  </main>
   
  </body>
</html>
