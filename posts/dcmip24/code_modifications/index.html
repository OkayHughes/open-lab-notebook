<!DOCTYPE html>
<html lang="en">
  <head>
    
    
    
    <meta charset="utf-8" />
    <link rel="icon" href="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5-1.ico?v=1630525741731" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Your new 11ty blog" />
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/style.css"/>
    <link rel="stylesheet" type="text/css" href="/open-lab-notebook/public/fonts/cmu.css"/>
 
    <link rel="stylesheet" href="https://unpkg.com/katex@latest/dist/katex.min.css" />
    
    <title>Open Lab Notebook</title>

<meta name="description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="robots" content="index,follow">
<meta name="author" content="undefined">

<link rel="canonical" href="https://undefined.glitch.me/posts/dcmip24/code_modifications/">

<meta property="og:title" content="Open Lab Notebook">
<meta property="og:type" content="article">

<meta property="og:url" content="https://undefined.glitch.me/posts/dcmip24/code_modifications/">
<meta property="og:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta property="og:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">

<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://undefined.glitch.me/posts/dcmip24/code_modifications/">
<meta name="twitter:title" content="Open Lab Notebook">
<meta name="twitter:description" content="A blog which serves as my lab notebook, but which is visible to the world because I&apos;m a masochist.">
<meta name="twitter:image" content="https://cdn.glitch.com/8af1b7af-efae-4a35-b1d7-e47b835582bc%2Fall_TMQ_moist_day5.png?v=1630525127233">


  </head>
  <body>
  <main>
    
    
  
    


<div class="wrapper post">
  <div>
    
    <h1 class='postTitle'>Code modifications for stratosphere</h1>

    
    
    
    <p>The hybrid coordinates for the proposed gravity wave test case are located at <code>/glade/u/home/owhughes/homme_levels/hot_equal</code>.
88 levels corresponds to a maximum 800m grid spacing, 120 levels is 400m, and 207 levels is 200m.</p>
<p>The HOMME initialization script containing the modifications for the stratosphere is located at <code>/glade/u/home/owhughes/homme_levels/dcmip2016-baroclinic.F90</code>.
The three additional parameters are located at line 89.
<code>lapse_strat =-0.005d0 </code> is the nominal lapse rate in the stratosphere, <code>strat_start = 20d3</code> is the geometric height at which the stratosphere starts,
and <code>T_weight = 0.5d0</code> is the weight factor for the Skamarock modification to the base state. Because we have been running shallow-atmosphere simulations, I have so far left it as <code>0.5</code>, which is the default version of the test case described in our paper.
Setting <code>T_weight=0.8d0</code> was used in the Deep-atmosphere MPAS paper. If we decide to simulate on a full-size earth, then this modification isn't needed at all!</p>
<p>The remaining changes in the file are:</p>
<ul>
<li>Line 189: <code>T0 =  (T_weight * T0E + (1.0d0 - T_weight) * T0P)</code> (Skamarock modification)</li>
<li>Line 352: <code>T0 =  (T_weight * T0E +(1.0d0 - T_weight)* T0P)</code> (Skamarock modification)</li>
<li>Line 476: <code>T0 = (T_weight * T0E + (1.0d0 - T_weight) * T0P)</code> (Skamarock modification)</li>
<li>Line 478: <code>constAA = 1.d0 / lapse_strat</code> (Constant used in stratospheric temperature)</li>
<li>Lines 485-511: Stratospheric temperature structure.</li>
</ul>
<p>If we are running with a full-sized earth, then the namelist I use in HOMME is</p>
<pre><code>!
! namelist for dcmip2012 test2-0: steady-state atmosphere with orography
!_______________________________________________________________________
&amp;ctl_nl
  nthreads          = 1
  partmethod        = 4                         ! mesh parition method: 4 = space filling curve
  topology          = &quot;cube&quot;                    ! mesh type: cubed sphere
  test_case         = &quot;dcmip2016_test10&quot;       ! test identifier
  theta_hydrostatic_mode = .false.
  ne                = 30                        ! number of elements per cube face
  qsize             = 6                         ! num tracer fields
! ndays             = 14                         ! num simulation days: 0 = use nmax steps
  nmax              = 2000
  statefreq         = 1                       ! number of steps between screen dumps
  restartfreq       = -1                        ! don't write restart files if &lt; 0
  runtype           = 0                         ! 0 = new 
  rsplit            = 1                         ! unstable with desired rsplit=6 - why?
  qsplit            = 1
  integration       = 'explicit'                ! explicit time integration
  tstep_type        = 7                         ! 
  tstep             = 300                     ! largest timestep in seconds
!  tstep_type        = 5                         ! 
!  tstep             = 1                    ! largest timestep in seconds
  nu                = 1e15                      ! hyperviscosity 1e15*(ne30/ne3000)**3.2
  nu_s              = 1e15 
  nu_p              = 1e15 
  !nu_top            = 0
!  nu_top            =  2.5e5 !2.5e5/20
!  hypervis_subcycle_tom  = 6
  limiter_option      = 9  
  hypervis_order    = 2                         ! 2 = hyperviscosity
  hypervis_subcycle = 3                         ! 1 = no hyperviz subcycling
!  dcmip2_0_zetam    = 1e6
!  dcmip2_0_rm       = 0
!  omega             = 7.292D-3
!  rearth            = 6.371D4
!  omega             = 14.584D-4
!  rearth            = 3.1855D5
!omega             = 51.044D-4
!rearth            = 1.59275D5
  dcmip16_prec_type = -1    
    dcmip16_pbl_type  = -1 
/
&amp;vert_nl
  !vform             = &quot;ccm&quot;                     ! vertical coordinate type &quot;ccm&quot;=hybrid pressure/terrain
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/camm-30.ascii&quot;
!  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/cami-30.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_88_m.ascii&quot;
!   vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_88_i.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_88_m.ascii&quot;
!   vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_88_i.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_120_m.ascii&quot;
!  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_120_i.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_120_m.ascii&quot;
!  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_120_i.ascii&quot;
  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_207_m.ascii&quot;
  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_hot_207_i.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_401_m.ascii&quot;
!  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/z-equal_401_i.ascii&quot;
!  vfile_mid     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/aspL60_mid.ascii&quot;
!  vfile_int     = &quot;/home/owhughes/E3SM/DA_HOMME_E3SM/components/homme/test/vcoord/aspL60_int.ascii&quot;
/
&amp;analysis_nl
  output_dir        = &quot;./movies/one_mountain/&quot;               ! destination dir for netcdf file
  output_timeunits  = 0,                        ! 1=days, 2=hours, 0=timesteps
  output_frequency  = 100,                       ! output every 12 hours
  output_varnames1  ='T','ps','u','v','w','geo','geo_i', 'geos','pnh',&quot;Th&quot;,&quot;div&quot;   ! variables to write to file
  interp_type       = 1                         ! 0=native grid, 1=bilinear
  output_type       ='pnetcdf'                   ! netcdf or pnetcdf
  num_io_procs      = 16         
  interp_nlat       = 181
  interp_nlon       = 360
  interp_gridtype   = 1
/
&amp;prof_inparm
  profile_outpe_num   = 100
  profile_single_file	= .true.
/
</code></pre>

    <div class="controls">

    
      
          <h3>
            Parent post:
      </h3>
          <ul><li><a href="/posts/dcmip24/hybrid_coeffs/">DCMIP 2024</a></li></ul>
      
      
      
      
      
    </div>
  </div>
</div>


      <footer class="footer">
        <div class="links">
          <a href="/">Home</a>
          <span class="divider">|</span>
          <a href="/posts">Posts</a>
          <span class="divider">|</span>
          <a href="/about">About</a>
        </div>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/remix/glitch-hello-eleventy">
        <img src="https://cdn.glitch.com/605e2a51-d45f-4d87-a285-9410ad350515%2FLogo_Color.svg?v=1618199565140" alt="" /> 
        Remix on Glitch
        </a>
        <a class="btn--remix" target="_top" href="https://glitch.com/edit/#!/open-lab-notebook">
        Edit
        </a>
      </footer>
    
  </main>
   
  </body>
</html>
